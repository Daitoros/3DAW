<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listar Usuários</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Gerenciamento de Usuários</h1>
        
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Usuário</th>
                <th>Senha</th>
                <th>Função</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody id="tabelaUsuarios">
            </tbody>
    </table>
    <br>
    <button><a href='incluir_usuario.html'> Incluir Novo Usuário</a></button>
    <a href='gestor.html'>Voltar para Gerenciamento de Perguntas</a>

    <script src="db.js"></script>
    <script src="auth.js"></script>
    <script>
        protegerPagina('gestor');

        const tabelaUsuarios = document.getElementById('tabelaUsuarios');

        // Função para carregar os usuários na tabela
        function carregarTabela() {
            tabelaUsuarios.innerHTML = ''; // Limpa a tabela
            const usuarios = getUsuarios();

            if (usuarios.length === 0) {
                tabelaUsuarios.innerHTML = "<tr><td colspan='5'>Não há usuários cadastrados.</td></tr>";
                return;
            }

            usuarios.forEach((user, index) => {
                const linha = `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${user.usuario}</td>
                        <td>${user.senha}</td> <td>${user.funcao}</td>
                        <td>
                            <a href="alterar_usuario.html?id=${index}">Alterar</a> |
                            <a href="#" onclick="excluir(${index})">Excluir</a>
                        </td>
                    </tr>
                `;
                tabelaUsuarios.innerHTML += linha;
            });
        }

        // Função para excluir
        function excluir(id) {
            // Pega o usuário para mostrar o nome na confirmação
            const user = getUsuarioById(id);
            if (confirm(`Tem certeza que deseja excluir o usuário '${user.usuario}'?`)) {
                deleteUsuario(id);
                carregarTabela(); // Recarrega a tabela
            }
        }

        // Carrega a tabela quando a página abre
        window.onload = carregarTabela;
    </script>
</body>
</html>