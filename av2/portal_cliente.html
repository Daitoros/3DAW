<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha √Årea - Belle & Chic</title>
    <link rel="stylesheet" href="style_cliente.css">
    <style>
        /* Dashboard Layout */
        .welcome-banner {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 40px;
            border-radius: 10px;
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .welcome-text h1 { color: white; margin-bottom: 10px; font-size: 2rem; }
        .welcome-text p { font-size: 1.1rem; opacity: 0.9; }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 350px 1fr; /* Coluna fixa para agendar, resto para lista */
            gap: 30px;
        }
        @media (max-width: 850px) { .dashboard-grid { grid-template-columns: 1fr; } }

        .dash-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            height: fit-content;
        }
        .dash-card h2 { font-size: 1.4rem; border-bottom: 2px solid #f0f0f0; padding-bottom: 15px; margin-bottom: 20px; }

        /* Tabela mais bonita */
        .agendamento-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: 0.2s;
        }
        .agendamento-item:hover { background: #f9f9f9; }
        .agendamento-info h4 { color: var(--primary); margin-bottom: 5px; }
        .agendamento-info span { display: block; font-size: 0.9rem; color: #666; }
        .agendamento-price { font-weight: bold; color: var(--gold); font-size: 1.1rem; }
        
        .badge {
            background: #e0f2f1; color: #00796B; 
            padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold;
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="container">
            <a href="home.html" class="logo">Belle & Chic</a>
            <nav class="nav-links">
                <a href="portal_cliente.html" class="active">Agendamentos</a>
                <a href="minha_conta.html">Meus Dados</a>
                <a href="#" onclick="logout()" style="color: #c14b4b;">Sair</a>
            </nav>
        </div>
    </header>

    <div class="container" style="margin-top: 30px;">
        
        <div class="welcome-banner">
            <div class="welcome-text">
                <h1>Ol√°, <span id="nome-usuario">Cliente</span>!</h1>
                <p>√â um prazer ter voc√™ aqui. Que tal real√ßar sua beleza hoje?</p>
            </div>
            <a href="#novo-agendamento" class="btn-cta" style="background: white; color: var(--primary) !important;">Agendar Agora</a>
        </div>

        <div class="dashboard-grid">
            
            <div class="dash-card" id="novo-agendamento">
                <h2>üíÖ Novo Agendamento</h2>
                <form id="formAgendamento" style="padding: 0; border: none; background: none;">
                    <label>Servi√ßo</label>
                    <input type="text" name="servico_desejado" placeholder="Ex: Corte e Escova" required>
                    
                    <label>Profissional (Opcional)</label>
                    <input type="text" name="nome_profissional" placeholder="Ex: Ana Silva">

                    <label>Data e Hora</label>
                    <input type="datetime-local" name="data_hora_agendamento" required>
                    
                    <input type="submit" value="Confirmar Agendamento" style="width: 100%; margin-top: 10px;">
                </form>
                <p id="msg"></p>
            </div>

            <div class="dash-card">
                <h2>üìÖ Seus Agendamentos</h2>
                <div id="lista-agendamentos">
                    <p style="text-align: center; color: #999; margin-top: 20px;">Carregando...</p>
                </div>
            </div>

        </div>
    </div>

    <script>
        // 1. AUTH & USER DATA
        fetch('api/check_session.php')
            .then(res => res.json())
            .then(data => {
                if (!data.logado) window.location.href = 'login_cliente.html';
                document.getElementById('nome-usuario').textContent = data.nome.split(' ')[0]; // Pega s√≥ o primeiro nome
                carregarLista();
            });

        // 2. CARREGAR LISTA (COM DESIGN NOVO)
        function carregarLista() {
            const divLista = document.getElementById('lista-agendamentos');
            
            fetch('api/listar_meus_agendamentos.php?t=' + Date.now())
                .then(res => res.json())
                .then(data => {
                    divLista.innerHTML = '';
                    
                    if (data.length === 0) {
                        divLista.innerHTML = '<p style="text-align:center; padding:30px; color:#888;">Voc√™ ainda n√£o tem agendamentos futuros.</p>';
                        return;
                    }

                    data.forEach(ag => {
                        // Se o PHP n√£o mandar o pre√ßo, assume 0
                        let valor = ag.valor ? parseFloat(ag.valor).toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'}) : 'R$ --';
                        let prof = ag.nome_profissional ? ag.nome_profissional : 'Profissional a definir';

                        divLista.innerHTML += `
                            <div class="agendamento-item">
                                <div class="agendamento-info">
                                    <h4>${ag.servico_desejado}</h4>
                                    <span>üìÖ ${ag.data_hora_formatada}</span>
                                    <span>‚úÇÔ∏è Com: ${prof}</span>
                                </div>
                                <div style="text-align: right;">
                                    <div class="agendamento-price">${valor}</div>
                                    <span class="badge">Confirmado</span>
                                </div>
                            </div>
                        `;
                    });
                });
        }

        // 3. NOVO AGENDAMENTO
        document.getElementById('formAgendamento').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const msg = document.getElementById('msg');
            
            msg.textContent = 'Agendando...';
            msg.className = 'msg';

            fetch('api/incluir_agendamento.php', { method: 'POST', body: formData })
                .then(res => res.json())
                .then(data => {
                    if (data.sucesso) {
                        msg.textContent = 'Sucesso!';
                        msg.classList.add('sucesso');
                        e.target.reset();
                        carregarLista(); // Atualiza a lista ao lado
                        
                        // Remove mensagem ap√≥s 3s
                        setTimeout(() => { msg.textContent = ''; msg.className = ''; }, 3000);
                    } else {
                        msg.textContent = data.erro;
                        msg.classList.add('erro');
                    }
                });
        });

        function logout() { fetch('api/logout_cliente.php').then(() => window.location.href = 'home.html'); }
    </script>
</body>
</html>